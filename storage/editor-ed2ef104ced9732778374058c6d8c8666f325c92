{"mode":"editor","version":1,"windowDimensions":{"x":4,"y":23,"width":1362,"height":741,"maximized":true},"grammars":{"deserializer":"GrammarRegistry","grammarOverridesByPath":{}},"project":{"paths":["/Users/ustrajunior/code/nextbit/superwifi-nordestao"],"buffers":[{"text":"var swn_processing = false;\nvar SWN_SESSION_NAME = \"swn_session\";\nvar SWN_API = \"https://swgo.ngrok.com/v1/\";\n\n$(function() {\n  user_signed_in();\n  binding();\n\n  setTimeout(function(){\n    if($(\"#login\").length > 0 && $(window).scrollTop() == 0 && !$(\"#username\").is(\":focus\")) {\n      $('html,body').animate({\n        scrollTop: $(\"#login\").offset().top\n      }, 1000);\n    }\n  }, 2000);\n\n});\n\n// function debuging(message) {\n//   $(\"#debuging ul\").append(\"<li>\" + message + \"</li>\");\n// }\n\n/*\n * Take out and put bindings in again when there are new elements on html\n */\nfunction binding() {\n  if( $(\"#submit\").length > 0) {\n    $(\"#submit\").unbind(\"click\");\n    $(\"#submit\").bind(\"click\", function(e) {\n      if (!swn_processing) {\n        login();\n      }\n    });\n  }\n\n  if( $(\"#resubmit\").length > 0) {\n    $(\"#resubmit\").unbind(\"click\");\n    $(\"#resubmit\").bind(\"click\", function(e) {\n      e.preventDefault();\n      if (!swn_processing) {\n        relogin();\n      }\n    });\n  }\n\n  if( $(\"#username\").length > 0) {\n    $(\"#username\").unbind(\"keyup\");\n    $(\"#username\").bind(\"keyup\", function(e) {\n      if($(this).val().length == 11) {\n        $(this).blur();\n      }\n    });\n  }\n\n  if( $(\"#faqs_action\").length > 0) {\n    $(\"#faqs_action\").unbind(\"click\");\n    $('#faqs_action').bind(\"click\", function(e) {\n      $(\"#faqs .faqs-list\").show();\n    });\n  }\n\n  if( $(\".logout\").length > 0) {\n    $(\".logout\").unbind(\"click\");\n    $(\".logout\").bind(\"click\", function(e) {\n      e.preventDefault();\n      $.pgwCookie({ name: SWN_SESSION_NAME, value: null });\n      location.reload();\n    });\n  }\n}\n\n/*\n * Verify and gather user information for login\n */\nfunction login() {\n  starting_process();\n\n  // Getting info\n  info = {\n    \"user\": {\n      \"username\": $(\"#username\").val(),\n      \"user_agent\": navigator.userAgent,\n      \"login_url\": parse(\"login_url\")\n    }\n  }\n\n  // Checking info\n  errors = verify_info(info);\n\n  // Requesting info\n  if(errors.length == 0) {\n    request_login(info, \"login\");\n  } else {\n    finishing_process(errors[0]);\n  }\n}\n\n/*\n * Verify and gather user information for relogin\n */\nfunction relogin() {\n  if( invalid_value($.pgwCookie({ name: SWN_SESSION_NAME })) || invalid_value(parse(\"login_url\")) ) {\n    finishing_process(m(\"server_error\"));\n  } else {\n    starting_process();\n\n    // Getting info\n    info = {\n      \"user\": {\n        \"session_id\": $.pgwCookie({ name: SWN_SESSION_NAME }),\n        \"login_url\": parse(\"login_url\")\n      }\n    }\n\n    request_login(info, \"relogin\");\n  }\n}\n\n/*\n * Ajax request to login\n * 58871591208\n */\nfunction request_login(info, action) {\n  $.ajax({\n    type: \"POST\",\n    url: SWN_API + \"user/\" + action,\n    data: JSON.stringify(info)\n  }).complete(function( data ) {\n    if(data.status == 200) {\n      if (data.responseJSON.authorized == \"true\") {\n        t = 0;\n        try_to_connect = setInterval(function(){\n          t = t + 1;\n\n          if( hostReachable() ) {\n            if(action == \"login\") {\n              $.pgwCookie({ name: SWN_SESSION_NAME, value: data.responseJSON.session_id, expires: parseInt(data.responseJSON.session_time) });\n            }\n            show_message_page(\"go_to_internet\", m(\"access_granted\"));\n            clearInterval(try_to_connect);\n          } else {\n            if(t > 30) {\n              show_message_page(\"go_to_internet\", m(\"try_again\"));\n              clearInterval(try_to_connect);\n            }\n          }\n        }, 3000);\n\n      } else {\n        finishing_process(m(data.responseJSON.message));\n      }\n    } else {\n      if(data.status == 0) {\n        finishing_process(m(\"server_error\"));\n      } else {\n        if(data.status == 401) {\n          $.pgwCookie({ name: SWN_SESSION_NAME, value: null });\n          show_message_page(\"go_to_internet\", m(data.responseJSON.message));\n        } else {\n          finishing_process(m(data.responseJSON.message));\n        }\n      }\n    }\n  });\n}\n\n/*\n * Check if user informations: username, user agent and login url are valid\n */\nfunction verify_info(info) {\n  errors = [];\n\n  // username\n  if (invalid_value(info.user.username)) {\n    errors.push(m(\"cpf_required\"));\n  } else {\n    if (invalid_cpf(info.user.username)) {\n      errors.push(m(\"invalid_cpf\"));\n    }\n  }\n\n  // login_url e user_agent\n  if (invalid_value(info.user.login_url) || invalid_value(info.user.user_agent)) {\n    errors.push(m(\"try_reload\"));\n  }\n\n  return errors;\n}\n\n/*\n * Check if a value is invalid\n */\nfunction invalid_value(value) {\n  return value == \"\" || typeof(value) === 'undefined';\n}\n\n/*\n * Check if user is logged in and show a proper page in that case\n */\nfunction user_signed_in() {\n  if(typeof($.pgwCookie({ name: SWN_SESSION_NAME })) !== 'undefined') {\n    show_message_page(\"signedin\", m(\"click_to_continue\"));\n  }\n}\n\n/*\n * Load a html fragment to display some message\n */\nfunction show_message_page(page, message) {\n  $(\"#login .content\").load( page+\".html\", function( response, status, xhr ) {\n    $(\"#message\").html(message);\n    binding();\n  });\n  finishing_process();\n}\n\n/*\n * Executed at the before ajax requests to start \"processing\" mode\n */\nfunction starting_process() {\n  swn_processing = true;\n  $(\".button-link\").html($(\".button-link\").attr('data-wait'));\n  $(\".button-link\").prepend('<img src=\"images/loader.gif\">');\n}\n\n/*\n * Executed at the after ajax requests to finish \"processing\" mode\n */\nfunction finishing_process(message) {\n  if(typeof(message) === 'undefined') {\n    message = \"\";\n  }\n  swn_processing = false;\n  $(\".button-link\").html($(\".button-link\").attr('data-default'));\n  $(\".button-link img\").remove();\n  $(\"#result\").html(message);\n}\n\n/**\n *\n */\nfunction hostReachable() {\n  // Handle IE and more capable browsers\n  var xhr = new XMLHttpRequest();\n  var status;\n\n  // Open new request as a HEAD to the root hostname with a random param to bust the cache\n  xhr.open( \"HEAD\", \"https://headsup-superwifi.rhcloud.com/\" + Math.floor((1 + Math.random()) * 0x10000), false );\n\n  // Issue request and handle response\n  try {\n    xhr.send();\n    return ( (xhr.status >= 200 && xhr.status < 300) || xhr.status === 304 );\n  } catch (error) {\n    return false;\n  }\n}\n\n/*\n * Return message associated to the key\n */\nfunction m(key){\n  messages = {\n    \"invalid_cpf\": \"Esse CPF não é válido\",\n    \"cpf_required\": \"Por favor, informe seu CPF.\",\n    \"try_again\": \"Parece que houve algum problema, por favor, tente novamente\",\n    \"try_reload\": \"Houve algum problema, por favor, tente recarregar a página\",\n    \"server_error\": \"Houve algum erro na comunicação com o servidor, tente novamente em alguns instantes.\",\n    \"click_to_continue\": \"Clique no botão abaixo para continuar navegando.\",\n    \"access_granted\": \"Bem-vindo! Agora você pode acessar a Internet normalmente.\",\n\t\t\"accessdeniedfor\": \"Houve algum problema, por favor, tente recarregar a página.\",\n\t\t\"timereached\": \"Seu limite de navegação diária foi atingido.\",\n\t\t\"cpf_not_found\": \"CPF não encontrado. Você já se cadastrou no Show de Prêmios?\"\n  }\n\n  return messages[key];\n}\n\n/*\n * Get params from URL\n * - 'val' is the key of the params\n */\nfunction parse(val) {\n  var result = \"\", tmp = [];\n  location.search\n  .substr(1)\n      .split(\"&\")\n      .forEach(function (item) {\n      tmp = item.split(\"=\");\n      if (tmp[0] === val) result = decodeURIComponent(tmp[1]);\n  });\n  return result;\n}\n","markers":{"markers":{"1":{"id":1,"range":[[2,37],[2,37]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":6,"goalBufferRange":null,"preserveFolds":true,"skipAtomicTokens":true},"deserializer":"Marker"},"8":{"id":8,"range":[[2,0],[3,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"30":{"id":30,"range":[[2,0],[2,43]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"31":{"id":31,"range":[[18,0],[18,31]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"32":{"id":32,"range":[[129,0],[129,51]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"33":{"id":33,"range":[[131,0],[131,48]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"54":{"id":54,"range":[[2,0],[2,43]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"55":{"id":55,"range":[[18,0],[18,31]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"56":{"id":56,"range":[[129,0],[129,51]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"57":{"id":57,"range":[[131,0],[131,48]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"id":1,"oldParams":{"tailed":true,"range":[[2,23],[2,37]]},"newParams":{"tailed":false,"range":[[2,23],[2,23]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,23],[2,37]],"newRange":[[2,23],[2,24]],"oldText":"localhost:3000","newText":"s","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"properties":{"type":"selection","editorId":6,"goalBufferRange":null,"preserveFolds":true},"range":[[2,23],[2,23]]},"newParams":{"properties":{"type":"selection","editorId":6,"goalBufferRange":null,"preserveFolds":true,"skipAtomicTokens":true},"range":[[2,24],[2,24]]},"deserializer":"MarkerPatch"},{"oldRange":[[2,24],[2,24]],"newRange":[[2,24],[2,25]],"oldText":"","newText":"w","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,25],[2,25]],"newRange":[[2,25],[2,26]],"oldText":"","newText":"g","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,26],[2,26]],"newRange":[[2,26],[2,27]],"oldText":"","newText":"o","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,27],[2,27]],"newRange":[[2,27],[2,28]],"oldText":"","newText":".","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,28],[2,28]],"newRange":[[2,28],[2,29]],"oldText":"","newText":"n","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,29],[2,29]],"newRange":[[2,29],[2,30]],"oldText":"","newText":"g","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,30],[2,30]],"newRange":[[2,30],[2,31]],"oldText":"","newText":"r","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,31],[2,31]],"newRange":[[2,31],[2,32]],"oldText":"","newText":"o","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,32],[2,32]],"newRange":[[2,32],[2,33]],"oldText":"","newText":"k","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,33],[2,33]],"newRange":[[2,33],[2,34]],"oldText":"","newText":".","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,34],[2,34]],"newRange":[[2,34],[2,35]],"oldText":"","newText":"c","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"},{"oldRange":[[2,35],[2,35]],"newRange":[[2,35],[2,36]],"oldText":"","newText":"o","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"},{"patches":[{"oldRange":[[2,36],[2,36]],"newRange":[[2,36],[2,37]],"oldText":"","newText":"m","normalizeLineEndings":true,"markerPatches":{},"deserializer":"BufferPatch"}],"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History"},"encoding":"utf8","filePath":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"21f15d7a2fd9e4c01e2bcd69da9c53a9374d361c","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":3,"items":[{"id":6,"softTabs":true,"displayBuffer":{"id":7,"softWrapped":true,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","invisibles":{"eol":"¬","space":"·","tab":"»","cr":"¤"},"deserializer":"TokenizedBuffer"},"invisibles":{"eol":"¬","space":"·","tab":"»","cr":"¤"},"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"}],"activeItemURI":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","focused":true,"deserializer":"Pane"},"activePaneId":3,"deserializer":"PaneContainer","version":1},"fullScreen":false,"packagesWithActiveGrammars":["language-javascript","language-hyperlink","language-todo"],"deserializer":"Workspace"},"packageStates":{"fuzzy-finder":{"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js":1427119815486},"metrics":{"sessionLength":11076},"tree-view":{"directoryExpansionStates":{"/Users/ustrajunior/code/nextbit/superwifi-nordestao":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},".sass-cache":{"isExpanded":false,"entries":{}},"css":{"isExpanded":false,"entries":{}},"images":{"isExpanded":false,"entries":{}},"js":{"isExpanded":true,"entries":{}},"node_modules":{"isExpanded":false,"entries":{}}}}},"selectedPath":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200},"find-and-replace":{"viewState":"","modelState":{"useRegex":false,"inCurrentSelection":false,"caseSensitive":false,"wholeWord":false},"projectViewState":"","resultsModelState":{"useRegex":false,"caseSensitive":false},"findHistory":["login_url"],"replaceHistory":[],"pathsHistory":[]}}}