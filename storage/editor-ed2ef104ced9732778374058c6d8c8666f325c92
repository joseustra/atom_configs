{"mode":"editor","version":1,"windowDimensions":{"x":4,"y":23,"width":1362,"height":745,"maximized":true},"grammars":{"deserializer":"GrammarRegistry","grammarOverridesByPath":{}},"project":{"paths":["/Users/ustrajunior/code/nextbit/superwifi-nordestao"],"buffers":[{"text":"var swn_processing = false;\nvar SWN_SESSION_NAME = \"swn_session\";\nvar SWN_API = \"https://apinordestao.superwifi.net.br/v1/\";\n\n$(function() {\n  user_signed_in();\n  binding();\n\n  setTimeout(function(){\n    if($(\"#login\").length > 0 && $(window).scrollTop() == 0) {\n      $('html,body').animate({\n        scrollTop: $(\"#login\").offset().top\n      }, 1000);\n    }\n  }, 2000);\n\n});\n\n/*\n * Take out and put bindings in again when there are new elements on html\n */\nfunction binding() {\n  if( $(\"#submit\").length > 0) {\n    $(\"#submit\").unbind(\"click\");\n    $(\"#submit\").bind(\"click\", function(e) {\n      if (!swn_processing) {\n        login();\n      }\n    });\n  }\n\n  if( $(\"#resubmit\").length > 0) {\n    $(\"#resubmit\").unbind(\"click\");\n    $(\"#resubmit\").bind(\"click\", function(e) {\n      e.preventDefault();\n      if (!swn_processing) {\n        relogin();\n      }\n    });\n  }\n\n  if( $(\"#faqs_action\").length > 0) {\n    $(\"#faqs_action\").unbind(\"click\");\n    $('#faqs_action').bind(\"click\", function(e) {\n      $(\"#faqs .faqs-list\").show();\n    });\n  }\n\n  if( $(\".logout\").length > 0) {\n    $(\".logout\").unbind(\"click\");\n    $(\".logout\").bind(\"click\", function(e) {\n      e.preventDefault();\n      $.pgwCookie({ name: SWN_SESSION_NAME, value: null });\n      location.reload();\n    });\n  }\n}\n\n/*\n * Verify and gather user information for login\n */\nfunction login() {\n  starting_process();\n\n  // Getting info\n  info = {\n    \"user\": {\n      \"username\": $(\"#username\").val(),\n      \"user_agent\": navigator.userAgent,\n      \"login_url\": parse(\"login_url\")\n    }\n  }\n\n  // Checking info\n  errors = verify_info(info);\n\n  // Requesting info\n  if(errors.length == 0) {\n    request_login(info, \"login\");\n  } else {\n    finishing_process(errors[0]);\n  }\n}\n\n/*\n * Verify and gather user information for relogin\n */\nfunction relogin() {\n  if( invalid_value($.pgwCookie({ name: SWN_SESSION_NAME })) || invalid_value(parse(\"login_url\")) ) {\n    finishing_process(m(\"server_error\"));\n  } else {\n    starting_process();\n\n    // Getting info\n    info = {\n      \"user\": {\n        \"session_id\": $.pgwCookie({ name: SWN_SESSION_NAME }),\n        \"login_url\": parse(\"login_url\")\n      }\n    }\n\n    request_login(info, \"relogin\");\n  }\n}\n\n/*\n * Ajax request to login\n * 58871591208\n */\nfunction request_login(info, action) {\n  $.ajax({\n    type: \"POST\",\n    url: SWN_API + \"user/\" + action,\n    data: JSON.stringify(info)\n  }).complete(function( data ) {\n    if(data.status == 200) {\n      if (data.responseJSON.authorized == \"true\") {\n        if(action == \"login\") {\n          $.pgwCookie({ name: SWN_SESSION_NAME, value: data.responseJSON.session_id, expires: parseInt(data.responseJSON.session_time) });\n        }\n        show_message_page(\"go_to_internet\", m(\"access_granted\"));\n      } else {\n        finishing_process(m(data.responseJSON.message));\n      }\n    } else {\n      if(data.status == 0) {\n        finishing_process(m(\"server_error\"));\n      } else {\n        if(data.status == 401) {\n          $.pgwCookie({ name: SWN_SESSION_NAME, value: null });\n          show_message_page(\"go_to_internet\", m(data.responseJSON.message));\n        } else {\n          finishing_process(m(data.responseJSON.message));\n        }\n      }\n    }\n  });\n}\n\n/*\n * Check if user informations: username, user agent and login url are valid\n */\nfunction verify_info(info) {\n  errors = [];\n\n  // username\n  if (invalid_value(info.user.username)) {\n    errors.push(m(\"cpf_required\"));\n  } else {\n    if (invalid_cpf(info.user.username)) {\n      errors.push(m(\"invalid_cpf\"));\n    }\n  }\n\n  // login_url e user_agent\n  if (invalid_value(info.user.login_url) || invalid_value(info.user.user_agent)) {\n    errors.push(m(\"try_reload\"));\n  }\n\n  return errors;\n}\n\n/*\n * Check if a value is invalid\n */\nfunction invalid_value(value) {\n  return value == \"\" || typeof(value) === 'undefined';\n}\n\n/*\n * Check if user is logged in and show a proper page in that case\n */\nfunction user_signed_in() {\n  if(typeof($.pgwCookie({ name: SWN_SESSION_NAME })) !== 'undefined') {\n    show_message_page(\"signedin\", m(\"click_to_continue\"));\n  }\n}\n\n/*\n * Load a html fragment to display some message\n */\nfunction show_message_page(page, message) {\n  $(\"#login .content\").load( page+\".html\", function( response, status, xhr ) {\n    $(\"#message\").html(message);\n    binding();\n  });\n  finishing_process();\n}\n\n/*\n * Executed at the before ajax requests to start \"processing\" mode\n */\nfunction starting_process() {\n  swn_processing = true;\n  $(\".button-link\").html($(\".button-link\").attr('data-wait'));\n}\n\n/*\n * Executed at the after ajax requests to finish \"processing\" mode\n */\nfunction finishing_process(message) {\n  if(typeof(message) === 'undefined') {\n    message = \"\";\n  }\n  swn_processing = false;\n  $(\".button-link\").html($(\".button-link\").attr('data-default'));\n  $(\"#result\").html(message);\n}\n\n/*\n * Return message associated to the key\n */\nfunction m(key){\n  messages = {\n    \"invalid_cpf\": \"Esse CPF não é válido\",\n    \"cpf_required\": \"Por favor, informe seu CPF.\",\n    \"try_reload\": \"Houve algum problema, por favor, tente recarregar a página\",\n    \"server_error\": \"Houve algum erro na comunicação com o servidor, tente novamente em alguns instantes.\",\n    \"click_to_continue\": \"Clique no botão abaixo para continuar navegando.\",\n    \"access_granted\": \"Bem-vindo! Agora você pode acessar a Internet normalmente.\",\n\t\t\"accessdeniedfor\": \"Houve algum problema, por favor, tente recarregar a página.\",\n\t\t\"timereached\": \"Seu limite de navegação diária foi atingido.\",\n\t\t\"cpf_not_found\": \"CPF não encontrado. Você já se cadastrou no Show de Prêmios?\"\n  }\n\n  return messages[key];\n}\n\n/*\n * Get params from URL\n * - 'val' is the key of the params\n */\nfunction parse(val) {\n  var result = \"\", tmp = [];\n  location.search\n  .substr(1)\n      .split(\"&\")\n      .forEach(function (item) {\n      tmp = item.split(\"=\");\n      if (tmp[0] === val) result = decodeURIComponent(tmp[1]);\n  });\n  return result;\n}\n","markers":{"markers":{"1":{"id":1,"range":[[69,21],[69,21]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":6,"goalBufferRange":null,"preserveFolds":true},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History"},"encoding":"utf8","filePath":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"b1703ba9f328b2965a43dbe31b9c20cc0f70ffd1","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":3,"items":[{"id":6,"softTabs":true,"displayBuffer":{"id":7,"softWrapped":true,"editorWidthInChars":null,"scrollTop":847,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","invisibles":{"eol":"¬","space":"·","tab":"»","cr":"¤"},"deserializer":"TokenizedBuffer"},"invisibles":{"eol":"¬","space":"·","tab":"»","cr":"¤"},"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"}],"activeItemURI":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","focused":true,"deserializer":"Pane"},"activePaneId":3,"deserializer":"PaneContainer","version":1},"fullScreen":false,"packagesWithActiveGrammars":["language-javascript","language-hyperlink","language-todo"],"deserializer":"Workspace"},"packageStates":{"fuzzy-finder":{"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js":1426096497997},"metrics":{"sessionLength":5424},"tree-view":{"directoryExpansionStates":{"/Users/ustrajunior/code/nextbit/superwifi-nordestao":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},".sass-cache":{"isExpanded":false,"entries":{}},"css":{"isExpanded":false,"entries":{}},"images":{"isExpanded":false,"entries":{}},"js":{"isExpanded":true,"entries":{}},"node_modules":{"isExpanded":false,"entries":{}}}}},"selectedPath":"/Users/ustrajunior/code/nextbit/superwifi-nordestao/js/app.js","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200},"find-and-replace":{"viewState":"","modelState":{"useRegex":false,"inCurrentSelection":false,"caseSensitive":false,"wholeWord":false},"projectViewState":"","resultsModelState":{"useRegex":false,"caseSensitive":false},"findHistory":["login_url"],"replaceHistory":[],"pathsHistory":[]}}}