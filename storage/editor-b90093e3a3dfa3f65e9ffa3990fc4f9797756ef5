{"mode":"editor","version":1,"windowDimensions":{"x":4,"y":23,"width":1362,"height":741,"maximized":true},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"paths":["/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go"],"buffers":[{"text":"package main\n\nimport (\n\t\"encoding/json\"\n\t\"log\"\n\t\"net/http\"\n\t\"os\"\n\n\t\"code.nextbit.com.br/cmx_go/cmxapi\"\n\t\"code.nextbit.com.br/cmx_go/configs\"\n\t\"code.nextbit.com.br/cmx_go/server\"\n\t\"github.com/gorilla/mux\"\n)\n\nvar (\n\tglobalConfiguration = new(config.Configuration)\n)\n\nfunc init() {\n\tloadConfiguration()\n}\n\nfunc main() {\n\tdb := globalConfiguration.Database.OpenDB()\n\tm := mux.NewRouter()\n\n\tm.Handle(\"/{subdomain}/v2/presence_api\", cmxapi.InsertPresenceV2Handler(db)).Methods(\"POST\")\n\tm.Handle(\"/{subdomain}/v2/presence_api\", cmxapi.PresenceAuthenticationHandler(db)).Methods(\"GET\")\n\tm.HandleFunc(`/{rest:[a-zA-Z0-9=\\-\\/]+}`, allowHeaders).Methods(\"OPTIONS\")\n\thttp.Handle(\"/\", m)\n\n\tserver.Start(globalConfiguration, m)\n}\n\nfunc allowHeaders(res http.ResponseWriter, req *http.Request) {\n\tres.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n\tres.Header().Set(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\")\n\tres.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS, PATCH, DELETE\")\n}\n\nfunc loadConfiguration() {\n\tconfigFilePath := \"configs/main.conf\"\n\n\tconfigFile, err := os.Open(configFilePath)\n\tif err != nil {\n\t\tlog.Fatal(err.Error())\n\t\tos.Exit(1)\n\t}\n\n\tconfigDecoder := json.NewDecoder(configFile)\n\terr = configDecoder.Decode(&globalConfiguration)\n\tif err != nil {\n\t\tlog.Fatal(err.Error())\n\t\tos.Exit(1)\n\t}\n}\n","markers":{"markers":{"1":{"id":1,"range":[[26,49],[26,72]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":62,"goalScreenRange":null},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History","version":1},"encoding":"utf8","filePath":"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxgo.go","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"87debebf6b70517887d0af981ba53c2aa065f565","deserializer":"TextBuffer"},{"text":"package cmxapi\n\nimport (\n\t\"database/sql\"\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"html\"\n\t\"io\"\n\t\"io/ioutil\"\n\t\"log\"\n\t\"net/http\"\n\n\t\"code.nextbit.com.br/cmx_go/auth\"\n\t\"code.nextbit.com.br/cmx_go/v2\"\n\t\"github.com/gorilla/mux\"\n\t\"github.com/mitchellh/mapstructure\"\n)\n\n// PresenceAuthenticationHandler do the CMX authentication\nfunc PresenceAuthenticationHandler(db *sql.DB) http.Handler {\n\treturn http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) {\n\t\tvars := mux.Vars(req)\n\t\tsubdomain := vars[\"subdomain\"]\n\n\t\tres.WriteHeader(http.StatusOK)\n\t\tres.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n\n\t\tio.WriteString(res, auth.Code(db, subdomain))\n\t})\n}\n\n// InsertPresenceV2Handler insert CMX data for the api v2\nfunc InsertPresenceV2Handler(db *sql.DB) http.Handler {\n\treturn http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) {\n\t\tbody, err := ioutil.ReadAll(req.Body)\n\n\t\tif err != nil {\n\t\t\tlog.Println(err)\n\t\t}\n\n\t\tfmt.Println(html.UnescapeString(string(body)))\n\n\t\tvar f interface{}\n\t\tfErr := json.Unmarshal(body, &f)\n\n\t\tif fErr != nil {\n\t\t\tlog.Println(fErr)\n\t\t}\n\n\t\tpresence := new(v2.Presence)\n\n\t\tdErr := mapstructure.Decode(f, &presence)\n\t\tif dErr != nil {\n\t\t\tlog.Fatal(dErr)\n\t\t}\n\n\t\tfmt.Println(presence)\n\n\t\tgo presence.Save(db)\n\t})\n}\n","markers":{"markers":{"1":{"id":1,"range":[[57,0],[57,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":86,"autoscroll":true,"goalScreenRange":null},"deserializer":"Marker"},"66":{"id":66,"range":[[56,13],[56,22]],"tailed":true,"reversed":false,"valid":true,"invalidate":"overlap","persistent":true,"properties":{},"deserializer":"Marker"},"111":{"id":111,"range":[[5,0],[7,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"112":{"id":112,"range":[[40,0],[41,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"113":{"id":113,"range":[[56,0],[58,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{},"deserializer":"Marker"},"116":{"id":116,"range":[[57,0],[57,0]],"tailed":true,"reversed":false,"valid":true,"invalidate":"overlap","persistent":true,"properties":{},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[{"patches":[{"oldRange":[[38,2],[38,5]],"newRange":[[38,2],[38,2]],"oldText":"// ","newText":"","normalizeLineEndings":true,"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[38,23],[38,23]],"valid":true},"3":{"range":[[29,3],[29,26]],"valid":true},"4":{"range":[[30,5],[30,28]],"valid":true},"7":{"range":[[38,23],[38,23]],"valid":true}},"deserializer":"Transaction"},{"patches":[{"oldRange":[[5,0],[5,0]],"newRange":[[5,0],[7,0]],"oldText":"","newText":"\t\"fmt\"\n\t\"html\"\n","normalizeLineEndings":false,"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[38,20],[38,20]],"valid":true},"3":{"range":[[29,3],[29,26]],"valid":true},"4":{"range":[[30,5],[30,28]],"valid":true},"8":{"range":[[38,20],[38,20]],"valid":true},"9":{"range":[[38,0],[39,0]],"valid":true}},"deserializer":"Transaction"},{"patches":[{"oldRange":[[55,0],[55,0]],"newRange":[[55,0],[56,0]],"oldText":"","newText":"\n","normalizeLineEndings":true,"oldMarkersSnapshot":{"32":{"range":[[55,0],[55,0]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,0],[56,0]],"newRange":[[56,0],[56,0]],"oldText":"","newText":"","normalizeLineEndings":true,"oldMarkersSnapshot":{"33":{"range":[[56,0],[56,0]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,0],[56,0]],"newRange":[[56,0],[57,0]],"oldText":"","newText":"\n","normalizeLineEndings":true,"oldMarkersSnapshot":{"33":{"range":[[56,0],[56,0]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[57,0],[57,0]],"newRange":[[57,0],[57,0]],"oldText":"","newText":"","normalizeLineEndings":true,"oldMarkersSnapshot":{"34":{"range":[[57,0],[57,0]],"valid":true}},"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[55,0],[55,0]],"valid":true},"3":{"range":[[31,3],[31,26]],"valid":true},"4":{"range":[[32,5],[32,28]],"valid":true},"14":{"range":[[5,0],[7,0]],"valid":true},"15":{"range":[[40,0],[41,0]],"valid":true},"32":{"range":[[55,0],[55,0]],"valid":true}},"deserializer":"Transaction"},{"patches":[{"oldRange":[[56,0],[56,0]],"newRange":[[56,0],[56,2]],"oldText":"","newText":"\t\t","normalizeLineEndings":true,"oldMarkersSnapshot":{"35":{"range":[[56,0],[56,0]],"valid":true},"38":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[56,0],[56,0]],"valid":true},"3":{"range":[[31,3],[31,26]],"valid":true},"4":{"range":[[32,5],[32,28]],"valid":true},"35":{"range":[[56,0],[56,0]],"valid":true},"36":{"range":[[5,0],[7,0]],"valid":true},"37":{"range":[[40,0],[41,0]],"valid":true},"38":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"Transaction"},{"patches":[{"oldRange":[[56,2],[56,2]],"newRange":[[56,2],[56,3]],"oldText":"","newText":"f","normalizeLineEndings":true,"oldMarkersSnapshot":{"39":{"range":[[56,2],[56,2]],"valid":true},"42":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,3],[56,3]],"newRange":[[56,3],[56,4]],"oldText":"","newText":"m","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"43":{"range":[[56,3],[56,3]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,4],[56,4]],"newRange":[[56,4],[56,5]],"oldText":"","newText":"t","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"44":{"range":[[56,4],[56,4]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,5],[56,5]],"newRange":[[56,5],[56,6]],"oldText":"","newText":".","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"45":{"range":[[56,5],[56,5]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,6],[56,6]],"newRange":[[56,6],[56,7]],"oldText":"","newText":"P","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"46":{"range":[[56,6],[56,6]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,7],[56,7]],"newRange":[[56,7],[56,8]],"oldText":"","newText":"r","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"47":{"range":[[56,7],[56,7]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,8],[56,8]],"newRange":[[56,8],[56,9]],"oldText":"","newText":"i","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"48":{"range":[[56,8],[56,8]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,9],[56,9]],"newRange":[[56,9],[56,10]],"oldText":"","newText":"n","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"50":{"range":[[56,9],[56,9]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,10],[56,10]],"newRange":[[56,10],[56,11]],"oldText":"","newText":"t","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"51":{"range":[[56,10],[56,10]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,11],[56,11]],"newRange":[[56,11],[56,12]],"oldText":"","newText":"l","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"52":{"range":[[56,11],[56,11]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,12],[56,12]],"newRange":[[56,12],[56,13]],"oldText":"","newText":"n","normalizeLineEndings":true,"oldMarkersSnapshot":{"42":{"range":[[56,0],[58,0]],"valid":true},"53":{"range":[[56,12],[56,12]],"valid":true}},"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[56,2],[56,2]],"valid":true},"3":{"range":[[31,3],[31,26]],"valid":true},"4":{"range":[[32,5],[32,28]],"valid":true},"39":{"range":[[56,2],[56,2]],"valid":true},"40":{"range":[[5,0],[7,0]],"valid":true},"41":{"range":[[40,0],[41,0]],"valid":true},"42":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"Transaction"},{"patches":[{"oldRange":[[56,13],[56,13]],"newRange":[[56,13],[56,15]],"oldText":"","newText":"()","normalizeLineEndings":true,"oldMarkersSnapshot":{"54":{"range":[[56,13],[56,13]],"valid":true},"57":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"BufferPatch"},{"id":1,"oldParams":{"range":[[56,15],[56,15]]},"newParams":{"range":[[56,14],[56,14]]},"deserializer":"MarkerPatch"}],"oldMarkersSnapshot":{"1":{"range":[[56,13],[56,13]],"valid":true},"3":{"range":[[31,3],[31,26]],"valid":true},"4":{"range":[[32,5],[32,28]],"valid":true},"54":{"range":[[56,13],[56,13]],"valid":true},"55":{"range":[[5,0],[7,0]],"valid":true},"56":{"range":[[40,0],[41,0]],"valid":true},"57":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"Transaction"},{"patches":[{"oldRange":[[56,14],[56,14]],"newRange":[[56,14],[56,15]],"oldText":"","newText":"p","normalizeLineEndings":true,"oldMarkersSnapshot":{"63":{"range":[[56,13],[56,14]],"valid":true},"64":{"range":[[56,14],[56,15]],"valid":true},"65":{"range":[[56,14],[56,14]],"valid":true},"66":{"range":[[56,13],[56,14]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,15],[56,15]],"newRange":[[56,15],[56,16]],"oldText":"","newText":"r","normalizeLineEndings":true,"oldMarkersSnapshot":{"66":{"range":[[56,13],[56,15]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true},"72":{"range":[[56,15],[56,16]],"valid":true},"74":{"range":[[56,15],[56,15]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,16],[56,16]],"newRange":[[56,16],[56,17]],"oldText":"","newText":"e","normalizeLineEndings":true,"oldMarkersSnapshot":{"66":{"range":[[56,13],[56,16]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true},"78":{"range":[[56,16],[56,17]],"valid":true},"80":{"range":[[56,16],[56,16]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,17],[56,17]],"newRange":[[56,17],[56,18]],"oldText":"","newText":"s","normalizeLineEndings":true,"oldMarkersSnapshot":{"66":{"range":[[56,13],[56,17]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true},"83":{"range":[[56,17],[56,18]],"valid":true},"85":{"range":[[56,17],[56,17]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,18],[56,18]],"newRange":[[56,18],[56,19]],"oldText":"","newText":"e","normalizeLineEndings":true,"oldMarkersSnapshot":{"66":{"range":[[56,13],[56,18]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true},"88":{"range":[[56,18],[56,19]],"valid":true},"90":{"range":[[56,18],[56,18]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,19],[56,19]],"newRange":[[56,19],[56,20]],"oldText":"","newText":"n","normalizeLineEndings":true,"oldMarkersSnapshot":{"66":{"range":[[56,13],[56,19]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true},"93":{"range":[[56,19],[56,20]],"valid":true},"95":{"range":[[56,19],[56,19]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,20],[56,20]],"newRange":[[56,20],[56,21]],"oldText":"","newText":"c","normalizeLineEndings":true,"oldMarkersSnapshot":{"66":{"range":[[56,13],[56,20]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true},"98":{"range":[[56,20],[56,21]],"valid":true},"100":{"range":[[56,20],[56,20]],"valid":true}},"deserializer":"BufferPatch"},{"oldRange":[[56,21],[56,21]],"newRange":[[56,21],[56,22]],"oldText":"","newText":"e","normalizeLineEndings":true,"oldMarkersSnapshot":{"66":{"range":[[56,13],[56,21]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true},"103":{"range":[[56,21],[56,22]],"valid":true},"105":{"range":[[56,21],[56,21]],"valid":true}},"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[56,14],[56,14]],"valid":true},"3":{"range":[[31,3],[31,26]],"valid":true},"4":{"range":[[32,5],[32,28]],"valid":true},"63":{"range":[[56,13],[56,14]],"valid":true},"64":{"range":[[56,14],[56,15]],"valid":true},"65":{"range":[[56,14],[56,14]],"valid":true},"66":{"range":[[56,13],[56,14]],"valid":true},"67":{"range":[[5,0],[7,0]],"valid":true},"68":{"range":[[40,0],[41,0]],"valid":true},"69":{"range":[[56,0],[58,0]],"valid":true}},"deserializer":"Transaction"}],"redoStack":[],"deserializer":"History","version":1},"encoding":"utf8","filePath":"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxapi/cmxapi.go","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"f9f49a2158bb0c63d50e4db1591dd2c88fd85653","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":3,"items":[{"id":62,"softTabs":false,"displayBuffer":{"id":63,"softWrapped":true,"editorWidthInChars":null,"scrollTop":48,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxgo.go","deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"},{"id":86,"softTabs":false,"displayBuffer":{"id":87,"softWrapped":true,"editorWidthInChars":null,"scrollTop":428,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxapi/cmxapi.go","deserializer":"TokenizedBuffer"},"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"}],"activeItemURI":"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxapi/cmxapi.go","focused":true,"flexScale":1,"deserializer":"Pane"},"activePaneId":3,"deserializer":"PaneContainer","version":1},"fullScreen":false,"packagesWithActiveGrammars":["language-go","language-hyperlink","language-todo"],"deserializer":"Workspace"},"grammars":{"deserializer":"GrammarRegistry","grammarOverridesByPath":{}},"packageStates":{"fuzzy-finder":{"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxgo.go":1431966612369,"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxapi/cmxapi.go":1431966619734},"keybinding-resolver":{},"metrics":{"sessionLength":10290368},"tree-view":{"directoryExpansionStates":{"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},"auth":{"isExpanded":true,"entries":{}},"cmxapi":{"isExpanded":true,"entries":{}},"configs":{"isExpanded":true,"entries":{}},"database":{"isExpanded":true,"entries":{}},"db_scripts":{"isExpanded":true,"entries":{}},"requests":{"isExpanded":true,"entries":{}},"server":{"isExpanded":true,"entries":{}},"v2":{"isExpanded":true,"entries":{}}}}},"selectedPath":"/Users/ustrajunior/code/go/src/code.nextbit.com.br/cmx_go/cmxapi/cmxapi.go","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200},"find-and-replace":{"viewState":"","modelState":{"useRegex":false,"inCurrentSelection":false,"caseSensitive":false,"wholeWord":false},"projectViewState":"","resultsModelState":{"useRegex":false,"caseSensitive":false},"findHistory":["GetDB","InsertPresenceV2Handler"],"replaceHistory":[],"pathsHistory":[]}}}